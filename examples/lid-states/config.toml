# HyprDynamicMonitors - Lid State Matching Example
#
# This example demonstrates using lid state conditions to create
# different monitor profiles for Lid opened vs closed.
#
# Use case: Disable monitor when the lid is closed.
#
# NOTE: You need to run the service with `--enable-lid-events` for the lid events to work.

[general]
destination = "$HOME/.config/hypr/config.d/99_autogenerated-monitors.conf"

# The service will add the following default values, you can check if they match your system with:
# 1) For the query:
# $ gdbus call --system --dest org.freedesktop.UPower --object-path /org/freedesktop/UPower --method org.freedesktop.DBus.Properties.Get org.freedesktop.UPower LidIsClosed
# 2) For signals run the following then observe the output while closing the lid:
# $ gdbus monitor --system --dest org.freedesktop.UPower --object-path /org/freedesktop/UPower
# The defaults would match the following signal:
# $ /org/freedesktop/UPower: org.freedesktop.DBus.Properties.PropertiesChanged ('org.freedesktop.UPower', {'LidIsClosed': <true>}, @as [])
# The format is:
# $ {object_path}: {interface}.{member} ({signal_name}, {body})
# 3) As broad signals can be noisy the service filters them with the name and body, the body is cast as JSON string and filtered as strings.
# You can adjust the receive filters accordingly to what you see above.
[lid_events]

# how to query for the current up-to-date lid state
[lid_events.dbus_query_object]
destination = "org.freedesktop.UPower"
path = "/org/freedesktop/UPower"
method = "org.freedesktop.DBus.Properties.Get"
# When the call returns a value:
# $ gdbus call --system --dest org.freedesktop.UPower --object-path /org/freedesktop/UPower --method org.freedesktop.DBus.Properties.Get org.freedesktop.UPower LidIsClosed
# $ (<false>,)
# the received variant is cast as string and compared with the following value, when the comparison is true the internal state will reflect the lid closing event
expected_lid_closing_value = "true"

[[lid_events.dbus_query_object.args]]
arg = "org.freedesktop.UPower"

[[lid_events.dbus_query_object.args]]
arg = "LidIsClosed"

# which signals to match
[[lid_events.dbus_signal_match_rules]]
interface = "org.freedesktop.DBus.Properties"
object_path = "/org/freedesktop/UPower"
member = "PropertiesChanged"

# receive filters
[[lid_events.dbus_signal_receive_filters]]
name = "org.freedesktop.DBus.Properties.PropertiesChanged"
body = "LidIsClosed"

# Lid closed
[profiles.lid_closed]
config_file = "hyprconfigs/closed.conf"
config_file_type = "static"

[profiles.lid_closed.conditions]
lid_state = "Closed"

[[profiles.lid_closed.conditions.required_monitors]]
name = "eDP-1"

# Lid opened
[profiles.lid_opened]
config_file = "hyprconfigs/opened.conf"
config_file_type = "static"

[profiles.lid_opened.conditions]
lid_state = "Opened"

[[profiles.lid_opened.conditions.required_monitors]]
name = "eDP-1"
